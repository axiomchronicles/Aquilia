{% extends "base.html" %}

{% block title %}Aquilia Chat - Real-time Messaging{% endblock %}

{% block content %}
<div class="chat-app">
    <!-- Sidebar with rooms and users -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>Aquilia Chat</h1>
            <div class="user-info">
                <span class="username" id="current-username">guest</span>
                <button class="btn-edit-username" id="edit-username-btn">âœï¸</button>
            </div>
        </div>

        <!-- Rooms Section -->
        <div class="rooms-section">
            <div class="section-header">
                <h2>Rooms</h2>
                <button class="btn-icon" id="create-room-btn" title="Create Room">+</button>
            </div>
            <ul class="room-list" id="room-list">
                <li class="room-item active" data-room="general">
                    <span class="room-icon">#</span>
                    <span class="room-name">General</span>
                    <span class="unread-badge" style="display: none;">0</span>
                </li>
                <li class="room-item" data-room="random">
                    <span class="room-icon">#</span>
                    <span class="room-name">Random</span>
                    <span class="unread-badge" style="display: none;">0</span>
                </li>
            </ul>
        </div>

        <!-- Online Users Section -->
        <div class="users-section">
            <div class="section-header">
                <h2>Online</h2>
                <span class="online-count" id="online-count">0</span>
            </div>
            <ul class="user-list" id="user-list">
                <li class="user-item">
                    <span class="status-dot online"></span>
                    <span class="user-name">Loading...</span>
                </li>
            </ul>
        </div>

        <!-- Stats -->
        <div class="stats-section">
            <div class="stat-item">
                <span class="stat-label">Rooms:</span>
                <span class="stat-value" id="stat-rooms">2</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Messages:</span>
                <span class="stat-value" id="stat-messages">0</span>
            </div>
        </div>
    </aside>

    <!-- Main Chat Area -->
    <main class="chat-main">
        <!-- Chat Header -->
        <header class="chat-header">
            <div class="room-info">
                <h2 class="current-room-name" id="current-room-name">
                    <span class="room-icon">#</span>
                    <span id="room-title">General</span>
                </h2>
                <p class="room-description" id="room-description">General discussion</p>
            </div>
            <div class="header-actions">
                <button class="btn-icon" id="room-settings-btn" title="Room Settings">âš™ï¸</button>
                <button class="btn-icon" id="leave-room-btn" title="Leave Room">ğŸšª</button>
            </div>
        </header>

        <!-- Messages Area -->
        <div class="messages-container" id="messages-container">
            <div class="welcome-message">
                <div class="welcome-icon">ğŸ’¬</div>
                <h3>Welcome to <span id="welcome-room">General</span></h3>
                <p>Start chatting with your team</p>
            </div>
            
            <!-- Messages will be dynamically inserted here -->
        </div>

        <!-- Typing Indicator -->
        <div class="typing-indicator" id="typing-indicator" style="display: none;">
            <span class="typing-user"></span>
            <span class="typing-dots">
                <span>.</span><span>.</span><span>.</span>
            </span>
        </div>

        <!-- Message Input -->
        <footer class="message-input-area">
            <div class="input-container">
                <button class="btn-icon" id="emoji-btn" title="Emoji">ğŸ˜Š</button>
                <input 
                    type="text" 
                    class="message-input" 
                    id="message-input" 
                    placeholder="Type a message..."
                    autocomplete="off"
                >
                <button class="btn-send" id="send-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2 10L18 3L13 10L18 17L2 10Z"/>
                    </svg>
                </button>
            </div>
        </footer>
    </main>
</div>

<!-- Modals -->
<div class="modal" id="username-modal" style="display: none;">
    <div class="modal-content">
        <h3>Set Username</h3>
        <input type="text" id="username-input" placeholder="Enter username" maxlength="32">
        <div class="modal-actions">
            <button class="btn btn-secondary" id="cancel-username-btn">Cancel</button>
            <button class="btn btn-primary" id="save-username-btn">Save</button>
        </div>
    </div>
</div>

<div class="modal" id="create-room-modal" style="display: none;">
    <div class="modal-content">
        <h3>Create Room</h3>
        <input type="text" id="room-name-input" placeholder="Room name" maxlength="50">
        <textarea id="room-desc-input" placeholder="Description (optional)" rows="3"></textarea>
        <label>
            <input type="checkbox" id="room-public-input" checked>
            Public room
        </label>
        <div class="modal-actions">
            <button class="btn btn-secondary" id="cancel-room-btn">Cancel</button>
            <button class="btn btn-primary" id="create-room-submit-btn">Create</button>
        </div>
    </div>
</div>

<!-- Connection Status -->
<div class="connection-status" id="connection-status">
    <span class="status-dot"></span>
    <span class="status-text">Connecting...</span>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ static('js/chat.js') }}"></script>
{% endblock %}
