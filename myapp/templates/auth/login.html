{% extends "base.html" %}

{% block body %}
<div class="auth-layout">
    <div class="auth-card">
        <div style="text-align:center;margin-bottom:24px">
            <div class="logo" style="width:48px;height:48px;font-size:22px;margin:0 auto 12px;background:linear-gradient(135deg,var(--accent),var(--purple));border-radius:var(--radius);display:flex;align-items:center;justify-content:center;color:white;font-weight:800">A</div>
        </div>
        <h2>Welcome back</h2>
        <p class="auth-subtitle">Sign in to your CRM dashboard</p>

        <div id="alertBox" class="alert"></div>

        <form id="loginForm" onsubmit="return handleLogin(event)">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="email" placeholder="you@company.com" required autofocus>
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" id="password" placeholder="Enter your password" required>
            </div>
            <button type="submit" class="btn btn-primary btn-lg" style="width:100%;justify-content:center;margin-top:8px" id="loginBtn">
                Sign In
            </button>
        </form>

        <div class="auth-footer">
            Don't have an account? <a href="/auth/register">Create one</a>
        </div>

        <div style="margin-top:20px;padding-top:16px;border-top:1px solid var(--border);text-align:center">
            <p class="text-muted" style="font-size:12px;margin-bottom:8px">Demo Credentials</p>
            <code style="font-size:12px;color:var(--text-secondary);background:var(--bg-hover);padding:4px 8px;border-radius:4px">admin@crm.io / admin123</code>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function handleLogin(e) {
    e.preventDefault();
    const btn = document.getElementById('loginBtn');
    const alert = document.getElementById('alertBox');
    btn.textContent = 'Signing in...';
    btn.disabled = true;
    alert.className = 'alert';

    try {
        const res = await apiCall('/auth/api/login', 'POST', {
            email: document.getElementById('email').value,
            password: document.getElementById('password').value
        });

        if (res.ok) {
            window.location = '/dashboard/';
        } else {
            alert.textContent = res.data.message || res.data.error || 'Invalid credentials';
            alert.className = 'alert alert-error';
        }
    } catch (err) {
        alert.textContent = 'Connection error. Please try again.';
        alert.className = 'alert alert-error';
    }

    btn.textContent = 'Sign In';
    btn.disabled = false;
}
</script>
{% endblock %}
