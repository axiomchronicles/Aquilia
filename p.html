<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
  <title>Evelax Trace — Enhanced Pro</title>
  <style>
    :root{
      --bg:#000000;
      --card:#071014;
      --muted:#98b6ac;
      --mongo:#47A248;
      --mongo-2:#76c893;
      --danger:#ff6b6b;
      --code-font: 'JetBrains Mono', 'Fira Code', 'SFMono-Regular', 'Courier New', monospace;
      --ui-font: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      --radius:16px;
      --pad:28px;
      --code-size:15.5px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;padding:34px;min-height:100vh;display:flex;align-items:center;justify-content:center;background:radial-gradient(900px 400px at 10% 10%, rgba(71,162,72,0.04), transparent 6%), var(--bg);font-family:var(--ui-font);color:#e9f6ef
    }

    /* layout */
    .stage{width:min(1500px,96vw);display:grid;grid-template-columns:520px 1fr;gap:26px;align-items:start}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008));border-radius:var(--radius);padding:var(--pad);box-shadow:0 30px 80px rgba(0,0,0,0.7);border:1px solid rgba(71,162,72,0.06)}

    /* left */
    .left .logo{width:96px;height:96px;border-radius:18px;display:grid;place-items:center;font-weight:900;background:linear-gradient(135deg,var(--mongo),var(--mongo-2));box-shadow:0 30px 80px rgba(71,162,72,0.14);font-size:28px;color:#04110a}
    .left .title{font-size:24px;font-weight:900}
    .left .sub{color:var(--muted);margin-top:8px}
    .badge{display:inline-block;padding:12px 18px;border-radius:999px;background:linear-gradient(90deg, rgba(71,162,72,0.18), rgba(71,162,72,0.12));color:var(--mongo);font-weight:900}
    .brief{font-family:var(--code-font);font-size:16px;background:rgba(255,255,255,0.01);padding:12px;border-radius:12px;color:#dff6e8;margin-top:12px}

    .neon{height:150px;border-radius:14px;position:relative;overflow:hidden;background:linear-gradient(90deg, rgba(71,162,72,0.03), rgba(255,255,255,0.01));border:1px solid rgba(71,162,72,0.04);margin-top:18px}
    .neon:before{content:'';position:absolute;left:-50%;top:0;width:50%;height:100%;background:linear-gradient(90deg, rgba(71,162,72,0.06), rgba(71,162,72,0.24), rgba(71,162,72,0.06));transform:skewX(-14deg);animation:slide 6s linear infinite}
    @keyframes slide{0%{left:-50%}50%{left:120%}100%{left:-50%}}

    .actions{display:flex;gap:12px;margin-top:18px}
    .btn{padding:12px 16px;border-radius:12px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit;font-weight:800;cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--mongo),var(--mongo-2));border:none;color:#04110a;box-shadow:0 18px 50px rgba(71,162,72,0.12)}

    .hints{margin-top:16px;padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(71,162,72,0.02), rgba(255,255,255,0.01));border:1px solid rgba(71,162,72,0.04);color:var(--muted)}

    /* right */
    .topbar{display:flex;justify-content:space-between;align-items:center}
    .meta{color:var(--muted)}
    .search{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.01);padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);min-width:360px}
    .search input{background:transparent;border:none;outline:none;color:inherit;font-size:14px}

    .tabs{display:flex;gap:10px;margin-top:14px}
    .tab{padding:10px 12px;border-radius:12px;background:transparent;border:1px solid rgba(255,255,255,0.02);cursor:pointer;color:var(--muted);font-weight:800}
    .tab.active{background:linear-gradient(90deg, rgba(71,162,72,0.06), rgba(71,162,72,0.03));color:#eafff0}

    .pane{margin-top:16px;overflow:auto}
    pre.trace{white-space:pre;tab-size:4;background:rgba(0,0,0,0.5);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);font-family:var(--code-font);font-size:var(--code-size);color:#dff5e6;line-height:1.7;max-height:720px;overflow:auto}

    /* framed list */
    .frames{margin-top:12px}
    .frame{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);margin-bottom:10px;cursor:pointer;background:linear-gradient(180deg, rgba(255,255,255,0.008), transparent)}
    .frame .left{font-family:var(--code-font);font-weight:900}
    .frame .meta{color:var(--muted);font-size:13px}

    .source{margin-top:14px;padding:14px;border-radius:12px;background:rgba(0,0,0,0.6);border:1px solid rgba(71,162,72,0.04)}

    /* responsivity */
    @media (max-width:980px){.stage{grid-template-columns:1fr}.left{order:2}.right{order:1}}
    @media (prefers-reduced-motion: reduce){.neon:before{animation:none}}

    /* accessibility focus */
    .frame:focus{outline:3px solid rgba(71,162,72,0.12)}

    /* small helper for copy badge */
    .copy-badge{position:fixed;right:34px;bottom:34px;background:var(--mongo);color:#04110a;padding:10px 14px;border-radius:14px;font-weight:900;box-shadow:0 12px 30px rgba(71,162,72,0.12);display:none}
  </style>
</head>
<body>
  <main class="stage">
    <section class="card left">
      <div style="display:flex;gap:16px;align-items:center">
        <div class="logo">E</div>
        <div>
          <div class="title">Evelax Trace — Pro</div>
          <div class="sub">Night-mode, faster triage, and contextual guidance — tuned for devs.</div>
        </div>
      </div>

      <div style="margin-top:18px;display:flex;gap:14px;align-items:center">
        <div class="badge">500 • ExampleError</div>
        <div class="brief">example.py • line <strong>42</strong></div>
      </div>

      <div class="neon" aria-hidden="true"></div>

      <div class="actions">
        <button class="btn primary" onclick="retry()">Retry</button>
        <button class="btn" onclick="copyText(getActiveTrace())">Copy Trace</button>
        <button class="btn" onclick="downloadTrace()">Download</button>
        <button class="btn" onclick="openReport()">Report</button>
      </div>

      <div class="hints">
        <strong>Quick Hints</strong>
        <ul style="margin:8px 0 0 18px">
          <li>Check preconditions in <code style="color:var(--mongo)">process()</code>.</li>
          <li>Validate external inputs and session state.</li>
        </ul>
      </div>

      <div style="margin-top:18px;color:var(--muted);font-size:13px">Powered by <strong>Evelax</strong> • Aquilify</div>
    </section>

    <aside class="card right">
      <div class="topbar">
        <div>
          <div style="font-weight:900;font-size:18px">Trace Explorer</div>
          <div class="meta">Request: <strong>GET /example</strong> · Environment: <strong>production</strong></div>
        </div>
        <div style="display:flex;gap:12px;align-items:center">
          <div class="search" role="search">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="opacity:.8"><path d="M21 21l-4.35-4.35" stroke="white" stroke-opacity="0.7" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="white" stroke-opacity="0.7" stroke-width="1.6"/></svg>
            <input id="filter" placeholder="Filter frames or search code (Ctrl/Cmd+F)" oninput="filterTrace(this.value)" />
          </div>
          <div style="display:flex;gap:8px">
            <button class="tab active" data-tab="formatted" onclick="switchTab(event)">Formatted</button>
            <button class="tab" data-tab="detailed" onclick="switchTab(event)">Detailed</button>
            <button class="tab" data-tab="request" onclick="switchTab(event)">Request</button>
          </div>
        </div>
      </div>

      <div class="pane">
        <div id="formatted"><pre class="trace" id="trace-formatted"></pre></div>

        <div id="detailed" style="display:none">
          <div id="frames" class="frames"></div>
          <div id="source" class="source" style="display:none"></div>
        </div>

        <div id="request" style="display:none"><pre class="trace" id="trace-request"></pre></div>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:16px">
        <div style="color:var(--muted)">Hints: <span style="color:#cfeedd">Click a frame to inspect source.</span></div>
        <div style="display:flex;gap:12px">
          <button class="btn" onclick="copyText(getActiveTrace())">Copy</button>
          <button class="btn primary" onclick="openInEditor()">Open in Editor</button>
        </div>
      </div>
    </aside>
  </main>

  <div class="copy-badge" id="copyBadge">Copied</div>

  <script>
    // placeholder trace data (server should inject real trace)
    const SAMPLE_TRACE = `Traceback (most recent call last):\n  File "example.py", line 38, in <module>\n    result = perform_work()\n  File "example.py", line 24, in perform_work\n    value = process(value)\n  File "example.py", line 40, in process\n    return x["key"]/0  # division by zero\n  File "example.py", line 42, in process\n    raise ExampleError("Something went wrong")\nExampleError: Something went wrong`;
    const SAMPLE_REQUEST = `User-Agent: ExampleBrowser/1.0\nMethod: GET\nPath: /example\nHost: example.local`;

    // escape
    function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

    // robust-ish regex highlighter for Python trace snippets
    function highlightPython(code){
      if(!code) return '';
      let out = esc(code);
      // docstrings/triple quotes
      out = out.replace(/('{3}[\s\S]*?'{3}|\"{3}[\s\S]*?\"{3})/g, '<span style="color:#ffd9b6">$1</span>');
      // comments
      out = out.replace(/(^|\n)(\s*#.*?)(?=\n|$)/g, '$1<span style="color:rgba(180,220,190,0.95)">$2</span>');
      // strings
      out = out.replace(/('(\\.|[^'\\])*')/g, '<span style="color:#ffd9b6">$1</span>');
      out = out.replace(/(\"(\\.|[^\\\"])*\")/g, '<span style="color:#ffd9b6">$1</span>');
      // numbers
      out = out.replace(/\b(0x[0-9a-fA-F]+|\d+\.?\d*|\d*\.\d+)\b/g, '<span style="color:#f6c6ea">$1</span>');
      // keywords
      const kw = ['def','return','if','elif','else','for','while','try','except','finally','raise','import','from','as','with','class','in','is','and','or','not','lambda','assert','yield','async','await','pass','break','continue'];
      out = out.replace(new RegExp('\\b('+kw.join('|')+')\\b','g'), m => `<strong style="color:var(--mongo)">${m}</strong>`);
      // builtins
      const bi = ['True','False','None','len','str','int','print','dict','list','set','tuple','open','range','map','filter','sum','min','max'];
      out = out.replace(new RegExp('\\b('+bi.join('|')+')\\b','g'), m => `<span style="color:#9fe3c6">${m}</span>`);
      return `<pre style="white-space:pre-wrap;font-family:var(--code-font);font-size:var(--code-size);margin:0;color:#dff5e6">${out}</pre>`;
    }

    // split trace into frames and render list
    function renderFrames(trace){
      const lines = trace.split('\n');
      const frames = [];
      for(let i=0;i<lines.length;i++){
        const m = lines[i].match(/\s*File \"(.+?)\", line (\d+), in (.+)/);
        if(m){
          const ctxStart = Math.max(0,i-2);
          const ctxEnd = Math.min(lines.length, i+3);
          const ctx = lines.slice(ctxStart, ctxEnd).join('\n');
          frames.push({file:m[1],line:m[2],fn:m[3],context:ctx});
        }
      }
      const container = document.getElementById('frames');
      if(!container) return;
      container.innerHTML = frames.map((f,idx)=>`<div class="frame" tabindex="0" data-idx="${idx}" onclick="showSource(${idx})">\n  <div class=\"left\">\n    <div style=\"font-family:var(--code-font);font-weight:900;color:#dff5e6\">${esc(f.file)} <span style=\"color:var(--muted);font-weight:700\">• ${esc(f.fn)}()</span></div>\n    <div class=\"meta\">line ${f.line}</div>\n  </div>\n  <div style=\"color:var(--mongo);font-weight:900\">Open</div>\n</div>`).join('');
      window.__frames = frames;
    }

    function showSource(idx){
      const f = window.__frames?.[idx];
      if(!f) return;
      const highlighted = highlightPython(f.context);
      const src = `<div style=\"font-weight:900;color:var(--mongo)\">${esc(f.file)} — line ${f.line} — ${esc(f.fn)}()</div>${highlighted}`;
      const el = document.getElementById('source');
      el.style.display = '';
      el.innerHTML = src;
      el.scrollIntoView({behavior:'smooth',block:'center'});
    }

    function renderFormatted(trace){
      const el = document.getElementById('trace-formatted');
      el.innerHTML = highlightPython(trace);
    }

    // utilities
    function getActiveTrace(){
      const tab = document.querySelector('.tab.active')?.dataset.tab || 'formatted';
      if(tab === 'request') return SAMPLE_REQUEST;
      return SAMPLE_TRACE;
    }
    function copyText(text){
      if(!text) return;
      navigator.clipboard?.writeText(text).then(()=>{
        const b = document.getElementById('copyBadge'); b.style.display = 'block'; setTimeout(()=>b.style.display='none',900);
      }, ()=>alert('Clipboard unavailable'));
    }
    function downloadTrace(){
      const blob = new Blob([getActiveTrace()],{type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='trace.log'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }
    function openInEditor(){ copyText(getActiveTrace()); alert('Trace copied — paste into your editor (vscode:// handlers supported if configured).'); }
    function retry(){ alert('Retry triggered — hook this up to re-run the failing request.'); }
    function openReport(){ const body=encodeURIComponent(getActiveTrace()+'\n\nRequest: GET /example\nEnvironment: production'); window.location.href=`mailto:bugs@yourteam.local?subject=${encodeURIComponent('Error report')}&body=${body}`; }

    function switchTab(e){ document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); const t = e.currentTarget || e; t.classList.add('active'); document.getElementById('formatted').style.display = t.dataset.tab==='formatted'? '':'none'; document.getElementById('detailed').style.display = t.dataset.tab==='detailed'? '':'none'; document.getElementById('request').style.display = t.dataset.tab==='request'? '':'none'; }

    function filterTrace(q){
      const frames = document.querySelectorAll('#frames .frame');
      frames.forEach(f=>{ f.style.display = f.innerText.toLowerCase().includes(q.toLowerCase())? '':'none' });
    }

    // initial render
    renderFormatted(SAMPLE_TRACE);
    document.getElementById('trace-request').innerText = SAMPLE_REQUEST;
    renderFrames(SAMPLE_TRACE);

    // keyboard shortcuts
    window.addEventListener('keydown',(e)=>{ if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='f'){ e.preventDefault(); document.getElementById('filter').focus(); } if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='c'){ e.preventDefault(); copyText(getActiveTrace()); } if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='r'){ e.preventDefault(); retry(); } })

    // respect reduced motion
    if(window.matchMedia('(prefers-reduced-motion: reduce)').matches) document.querySelectorAll('.neon:before').forEach(n=>n.style.animation='none');
  </script>
</body>
</html>
