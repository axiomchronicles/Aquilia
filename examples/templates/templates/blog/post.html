{% extends "layouts/base.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<article style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <header style="margin-bottom: 2rem; border-bottom: 2px solid #ecf0f1; padding-bottom: 1rem;">
        <h2 style="color: #2c3e50; font-size: 2rem; margin-bottom: 0.5rem;">{{ post.title | e }}</h2>
        
        <div style="color: #7f8c8d; font-size: 0.9rem;">
            <span>By <strong>{{ post.author | e }}</strong></span>
            <span style="margin: 0 0.5rem;">•</span>
            <span>{{ post.created_at | format_date }}</span>
        </div>
        
        {% if post.tags %}
            <div style="margin-top: 1rem;">
                {% for tag in post.tags %}
                    <a href="/blog/tag/{{ tag | e }}" 
                       style="display: inline-block; padding: 0.25rem 0.75rem; background: #ecf0f1; color: #34495e; text-decoration: none; border-radius: 12px; font-size: 0.85rem; margin-right: 0.5rem;">
                        #{{ tag | e }}
                    </a>
                {% endfor %}
            </div>
        {% endif %}
    </header>
    
    <div style="line-height: 1.8; color: #2c3e50;">
        {{ post.content | e | replace('\n', '<br>') | safe }}
    </div>
</article>

<section style="margin-top: 3rem;">
    <h3 style="color: #2c3e50; margin-bottom: 1rem;">
        Comments ({{ comments | length }})
    </h3>
    
    {% if comments %}
        <div style="display: grid; gap: 1rem;">
            {% for comment in comments %}
                {% include "components/comment.html" %}
            {% endfor %}
        </div>
    {% else %}
        <div style="background: white; padding: 2rem; border-radius: 8px; text-align: center;">
            <p style="color: #95a5a6;">No comments yet. Be the first to comment!</p>
        </div>
    {% endif %}
    
    {% if identity %}
        <form method="POST" action="/blog/post/{{ post.id }}/comment" 
              style="margin-top: 2rem; background: white; padding: 1.5rem; border-radius: 8px;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            
            <textarea name="content" 
                      placeholder="Write a comment..."
                      required
                      style="width: 100%; min-height: 100px; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; resize: vertical;"></textarea>
            
            <button type="submit" 
                    style="margin-top: 1rem; padding: 0.75rem 1.5rem; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem;">
                Post Comment
            </button>
        </form>
    {% else %}
        <div style="margin-top: 2rem; background: #ecf0f1; padding: 1.5rem; border-radius: 8px; text-align: center;">
            <p style="color: #7f8c8d;">
                <a href="/auth/login?next=/blog/post/{{ post.id }}" style="color: #3498db; text-decoration: none;">
                    Login
                </a> to leave a comment
            </p>
        </div>
    {% endif %}
</section>

<div style="margin-top: 2rem;">
    <a href="/blog" style="color: #3498db; text-decoration: none;">
        ← Back to Blog
    </a>
</div>
{% endblock %}
