{% extends "docs/doc_layout.html" %}

{% block doc_title %}Transactions - Python SDK{% endblock %}

{% block doc_content %}
{% set active_page = 'transactions' %}

<div class="mb-8">
    <h1
        class="text-4xl font-extrabold text-white mb-4 bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent">
        ACID Transactions</h1>
    <p class="text-lg text-gray-400">Multi-document atomicity with snapshot isolation.</p>
</div>

<!-- ACID Guarantees -->
<section class="mb-16">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="relative group">
            <div
                class="absolute -inset-0.5 bg-gradient-to-br from-green-500/20 to-transparent rounded-xl blur opacity-0 group-hover:opacity-100 transition">
            </div>
            <div class="relative p-5 bg-zinc-900/50 border border-white/5 rounded-xl backdrop-blur-sm">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-8 h-8 rounded-lg bg-green-500/10 flex items-center justify-center">
                        <i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i>
                    </div>
                    <h3 class="font-bold text-white">Atomicity</h3>
                </div>
                <p class="text-sm text-gray-400">All operations succeed or all fail. No partial commits.</p>
            </div>
        </div>

        <div class="relative group">
            <div
                class="absolute -inset-0.5 bg-gradient-to-br from-blue-500/20 to-transparent rounded-xl blur opacity-0 group-hover:opacity-100 transition">
            </div>
            <div class="relative p-5 bg-zinc-900/50 border border-white/5 rounded-xl backdrop-blur-sm">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-8 h-8 rounded-lg bg-blue-500/10 flex items-center justify-center">
                        <i data-lucide="eye" class="w-4 h-4 text-blue-500"></i>
                    </div>
                    <h3 class="font-bold text-white">Isolation</h3>
                </div>
                <p class="text-sm text-gray-400">Snapshot reads prevent dirty/phantom reads.</p>
            </div>
        </div>
    </div>
</section>

<!-- Usage Pattern -->
<section class="mb-16">
    <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
        <div
            class="w-8 h-8 rounded-lg bg-gradient-to-br from-crous-500/20 to-crous-500/5 flex items-center justify-center">
            <i data-lucide="git-branch" class="w-4 h-4 text-crous-500"></i>
        </div>
        Context Manager Pattern
    </h2>

    <div class="relative group mb-6">
        <div class="absolute -inset-1 bg-gradient-to-r from-crous-500/20 to-blue-500/20 rounded-2xl blur opacity-25">
        </div>
        <div class="relative bg-zinc-950/90 backdrop-blur-sm border border-white/10 rounded-2xl overflow-hidden">
            <div class="px-4 py-3 border-b border-white/5 bg-white/5 flex items-center justify-between">
                <span class="text-xs font-mono text-gray-500">transfer_funds.py</span>
                <span class="text-xs px-2 py-1 bg-green-500/10 text-green-400 rounded-full">Auto-commit</span>
            </div>
            <pre class="p-6 overflow-x-auto"><code class="language-python text-sm leading-relaxed text-gray-300"><span class="text-gray-500"># Automatic commit/rollback on context exit</span>
<span class="text-crous-400">async with</span> client.start_session() <span class="text-crous-400">as</span> session:
    <span class="text-crous-400">async with</span> session.start_transaction() <span class="text-crous-400">as</span> txn:
        
        <span class="text-gray-500"># Debit sender</span>
        <span class="text-crous-400">await</span> accounts.update_one(
            {<span class="text-green-400">"_id"</span>: <span class="text-green-400">"alice"</span>}, 
            {<span class="text-green-400">"$inc"</span>: {<span class="text-green-400">"balance"</span>: <span class="text-blue-400">-100</span>}}, 
            session=session
        )
        
        <span class="text-gray-500"># Credit receiver</span>
        <span class="text-crous-400">await</span> accounts.update_one(
            {<span class="text-green-400">"_id"</span>: <span class="text-green-400">"bob"</span>}, 
            {<span class="text-green-400">"$inc"</span>: {<span class="text-green-400">"balance"</span>: <span class="text-blue-400">100</span>}}, 
            session=session
        )
        
        <span class="text-gray-500"># ✓ Commits here if no exception</span>
        <span class="text-gray-500"># ✗ Rolls back if exception raised</span></code></pre>
        </div>
    </div>
</section>

<!-- Isolation Levels -->
<section class="mb-16">
    <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
        <div
            class="w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500/20 to-purple-500/5 flex items-center justify-center">
            <i data-lucide="layers" class="w-4 h-4 text-purple-500"></i>
        </div>
        Isolation Levels
    </h2>

    <div class="space-y-3">
        <div
            class="group p-4 bg-zinc-900/30 border border-white/5 rounded-xl hover:bg-zinc-900/50 hover:border-crous-500/20 transition-all">
            <div class="flex items-center justify-between mb-2">
                <code class="text-sm font-mono text-crous-400">READ_COMMITTED</code>
                <span class="text-xs px-2 py-1 bg-green-500/10 text-green-400 rounded-full">Default</span>
            </div>
            <p class="text-sm text-gray-400">Prevents dirty reads. Sees only committed data.</p>
        </div>

        <div
            class="group p-4 bg-zinc-900/30 border border-white/5 rounded-xl hover:bg-zinc-900/50 hover:border-blue-500/20 transition-all">
            <div class="flex items-center justify-between mb-2">
                <code class="text-sm font-mono text-blue-400">REPEATABLE_READ</code>
                <span class="text-xs px-2 py-1 bg-blue-500/10 text-blue-400 rounded-full">Snapshot</span>
            </div>
            <p class="text-sm text-gray-400">Consistent reads within transaction. Prevents non-repeatable reads.</p>
        </div>

        <div
            class="group p-4 bg-zinc-900/30 border border-white/5 rounded-xl hover:bg-zinc-900/50 hover:border-red-500/20 transition-all">
            <div class="flex items-center justify-between mb-2">
                <code class="text-sm font-mono text-red-400">SERIALIZABLE</code>
                <span class="text-xs px-2 py-1 bg-red-500/10 text-red-400 rounded-full">Strict</span>
            </div>
            <p class="text-sm text-gray-400">Full isolation. Highest consistency, lowest concurrency.</p>
        </div>
    </div>

    <div class="mt-6 p-4 bg-yellow-500/5 border border-yellow-500/20 rounded-xl">
        <div class="flex items-start gap-3">
            <i data-lucide="alert-triangle" class="w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"></i>
            <div>
                <p class="text-sm text-yellow-200 font-medium mb-1">Performance Trade-off</p>
                <p class="text-sm text-yellow-200/70">Higher isolation = lower throughput. Use <code
                        class="text-yellow-400">READ_COMMITTED</code> for most workloads.</p>
            </div>
        </div>
    </div>
</section>

<!-- Navigation -->
<div class="flex items-center justify-between pt-12 mt-12 border-t border-white/10">
    <a href="/docs/python/indexing" class="group flex items-center gap-2 text-gray-400 hover:text-white transition-all">
        <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i>
        <span>Indexing</span>
    </a>
    <a href="/docs/python/api"
        class="group flex items-center gap-2 text-white font-bold hover:text-crous-400 transition-all">
        <span>API Reference</span>
        <i data-lucide="arrow-right" class="w-4 h-4 group-hover:translate-x-1 transition-transform"></i>
    </a>
</div>

{% endblock %}